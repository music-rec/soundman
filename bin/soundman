#!/usr/bin/env node
const addToDb = require('./addToDb')
const worker = require('./worker')
const ytdl = require('ytdl-core')
const argv = require('yargs')
  .default('add-to-db', false)
  .default('is-worker', false)
  .default('title', false)
  .default('album', false)
  .default('author', false)
  .default('cover', false)
  .help('h')
  .alias('h', 'help')
  .argv

const url = argv._.shift()
const music = {
  url,
  title: argv.title,
  author: argv.author,
  album: argv.album,
  cover: argv.cover,
  video_id: ytdl.getVideoID(url)
}

if (argv.addToDb) {
  const o = {}
  Object.keys(music).forEach(k => music[k] ? o[k] = music[k] : false)
  return addToDb(o).then().catch(console.error)
}

if (argv.isWorker) {
  return worker().then().catch(console.error)
}

const downloader = require('./downloader')

downloader(music)
  .then(p => console.log('Music downloaded! See more at ' + p))
  .catch(console.error)

